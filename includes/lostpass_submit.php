<?php
/**
* @ Project: ID Account System 1.5.0
* @ Author: Yplitgroup (c)2012
* @ Email: yplitgroup@gmail.com
* @ Website: http://lemon9x.com 
* @ Phone: 0166.26.26.009
* @ Project ID: 876609683c4c7e392848e94d9f62e149
**/
// ############### CHECK ##############if( !defined('IS_MAIN') ) die(" Stop!!! ");if( defined( 'IS_USER' ) ) yplitgroupRedirectManager();$_SESSION['yplitgroupLostpassRecord']++;if( !empty( $_POST['email'] ) ){	$email = $f->load( 'security_post', array( 'email' ) );}elseif( !empty( $_POST['username'] ) ){	$username = $f->load('security_post', array( 'username' ) );}if( !empty( $email ) ) $username = ''; // Hum, Fix Error exists both $username and $emailif( !empty( $username ) ) $email = ''; //$humanverify = $f->load('security_post', array( 'humanverify' ) );if( !$_SESSION['yplitgroupHumanverify'] or $humanverify != $_SESSION['yplitgroupHumanverify'] ){	$yplitgroupError = $lang['humanverifyfail'];	$f->load('yplitgroupThemesHeader');	require_once( DIR . '/skin/' . SKINDIR . '/lostpass_form.php' );	$f->load('yplitgroupThemesFooter');	exit;}if( !$email and !$username ) {	$yplitgroupError = $lang['please_enter_username_or_password'];	$f->load('yplitgroupThemesHeader');	require_once( DIR . '/skin/' . SKINDIR . '/lostpass_form.php' );	$f->load('yplitgroupThemesFooter');	exit;}if( !empty( $email ) and yplitgroupCheckEmail( $email ) === false ) // Email{	$yplitgroupError = $lang['email_is_incorrect'];	$f->load('yplitgroupThemesHeader');	require_once( DIR . '/skin/' . SKINDIR . '/lostpass_form.php' );	$f->load('yplitgroupThemesFooter');	exit;}if( !empty( $username ) ){	if( $f->load( 'yplitgroupGetDbName' ) != 'vbb' )		$f->load( 'yplitgroupChangeDb', 'vbb' );	$db->query( "SELECT `userid`, `username`, `email` FROM `". TABLE_PREFIX ."user` WHERE `username` = " . $db->e( $username ) );	if( $db->nums() == 0 )	{		$yplitgroupError = $lang['username_is_not_found'];		$yplitgroupPageTitle = $lang['error_notice'];		$f->load('yplitgroupThemesHeader');		require_once( DIR . '/skin/' . SKINDIR . '/lostpass_error.php' );		$f->load('yplitgroupThemesFooter');		exit;	}}if( !empty( $email ) ){	if( $f->load( 'yplitgroupGetDbName' ) != 'vbb' )		$f->load( 'yplitgroupChangeDb', 'vbb' );	$result = $db->query( "SELECT `userid`, `username`, `email` FROM `". TABLE_PREFIX ."user` WHERE `email` = " . $db->e( $email ) );	if( $db->nums( $result ) == 0 )	{		$yplitgroupError = $lang['email_is_not_found'];		$yplitgroupPageTitle = $lang['error_notice'];		$f->load('yplitgroupThemesHeader');		require_once( DIR . '/skin/' . SKINDIR . '/lostpass_error.php' );		$f->load('yplitgroupThemesFooter');		exit;	}}// Query |^|	$data = $db->sql_fetch_assoc( $result );	if( $data['userid'] )	{		$username = unhtmlspecialchars( $data['username'] );		$activationid = build_user_activation_id( $data['userid'], 2, 1);		if( $f->load( 'yplitgroupGetDbName' ) != 'vbb' )			$f->load( 'yplitgroupChangeDb', 'vbb' );		$db->query( "INSERT INTO `". TABLE_PREFIX ."useractivation` SET `userid` = " . $data['userid'] . ", `dateline` = " . TIMENOW . ", `activationid` = " . $db->e( $activationid ) . ", `type` = 1" );		$subject = $lang['lostpass_email_subject'] . ' - ' . yplitgroupCreateAlias( $lang['lostpass_email_subject'] );		$link = $config['id_url'] . '/index.php?do=lostpass&amp;u='. $data['userid'] .'&amp;k=' . $activationid;		$url = @parse_url( $config['id_url'] );		$forum_title = ucfirst( $url['host'] );		eval( '$message = "' . $lang['lostpass_email_body'] . '";' );		$message = $message . "\n-------------------------\n" . yplitgroupCreateAlias( $message );		yplitgroupSendmail( $data['email'], $subject, $message, array( 'email'=>'yplitgroup@gmail.com', 'name'=>'Yplitgroup' ) );	}	$yplitgroupPageTitle = $lang['lostpass_successfull_pagetitle'];	$yplitgroupLostPassMessage = $lang['lostpass_successfully_message'];	$f->load('yplitgroupThemesHeader');	require_once( DIR . '/skin/' . SKINDIR . '/lostpass_successfully.php' );	$f->load('yplitgroupThemesFooter');?>